# innodb 日志

## 1. 介绍

- innodb 使用日志来减少提交事务时的开销，因为日志记录了事务，就无需在事务提交的时候将缓冲池中的脏快刷新到磁盘中
- 事务修改的数据和索引映射表空间的随机位置，刷新这些变更需要很多随机 I/O，而日志系统将随机 I/O 变成顺序 I/O，内存数据增量异步删除磁盘
- 实例故障靠重放日志恢复
- 分配的大小和数据库的写入速度，事务大小，异常重启后的恢复有很大的关系

## 2. 参数说明

### innodb_log_file_size

- 事务日志的大小，写操作多时可以增大
- ib_logfile 文件大小，这个值分配的大小和数据库的写入速度，事务大小，异常重启后的恢复有很大的关系
- 一般取 256M 可以兼顾性能和 recovery 的速度

### innodb_log_file_in_group

- 控制日志文件数，有几个 ib_logfile 文件（写操作多时可以增大 ，默认为 2 个）

### innodb_log_buffer_size

- 在被写入到日志文件之前, 确保有足够大的日志缓冲区来保存脏数据（具有大量事务的可以考虑设置 16M）

### innodb_flush_log_at_trx_commit

```
=0，Innodb中的Log Thread每隔1秒钟会将log buffer中的数据写入到文件，同时还会通知文件系统进行文件同步的flush操作，
    保证数据确实已经写入到磁盘上面的物理文件。但是，每次事务的结束并不会触发Log Thread将log buffer中的数据写入文件
    所以，当设置为0的时候，当MySQL Crash和OS Crash或者主机断电之后，最极端的情况是丢失1秒时间的数据变化

=1，这也是Innodb的默认设置
    我们每次事务的结束都会触发Log Thread将log buffer中的数据写入文件并通知文件系统同步文件

=2，当我们设置为2的时候， Log Thread会在我们每次事务结束的时候将数据写入事务日志，但是这里的写入仅仅是调用了文件系统的
    文件写入操作。而我们的文件系统都是有缓存机制的，所以Log Thread的这个写入并不能保证内容真的已经写入到物理磁盘上面
    完成持久化的动作
```

## 3. 用法

```
#关闭自动提交：
set global autocommit=0;

#开启事务
begin;
start transaction;

#回滚，事务结束
rollback;

#提交，事务结束
commit;
```
