# innodb 索引

## 1. 介绍

- 聚簇索引的叶子节点就是数据节点

## 2. 主键索引

- 聚簇索引中的每个叶子节点包含主键值、事务 ID、回滚指针(rollback pointer 用于事务和 MVCC）和余下的列
- 叶节点包含了完整的数据记录

## 3. 辅助索引

- 二级索引的叶子包含主键值，而不是行指针，减小了移动数据或者数据页面分裂时维护二级索引的开销，不需要更新索引的行指针
- 首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录

## 4. 优点

- 可以把相关数据保存在一起。减少磁盘 I/O
- 数据访问更快
- 使用覆盖索引扫描的查询可以直接使用页节点中的主键值

## 5. 缺点

- 聚簇数据最大限度地提高了 I/O 密集型应用的性能，但如果数据全部都放在内存中，则访问的顺序就没有那么重要了，聚簇索引也就没什么优势了
- 插入速速严重依赖于插入顺序。
- 更新聚簇索引列的代价很高。
- 出入新行或者主键更新需要移动时，可能面临"页分裂(page split)"问题
- 当行的主键值要求必须插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，页分裂会导致表占用更多的磁盘空间
- 二级索引（非聚簇索引）即普通索引，在其叶子节点包含了引用行的主键列

## 6. 其他

- 如果想在表上定义、很多索引，则争取尽量把主键定义得小一些
- InnoDB 数据文件本身是一颗 B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持 B+Tree 的特性而频繁的分裂调整，十分低效
