# 几种树结构比较

## 1. 二叉查找树

- 若左子树不空，则左子树上所有结点的值均小于它的根结点的值
- 若右子树不空，则右子树上所有结点的值均大于它的根结点的值
- 左、右子树也分别为二叉排序树
- 没有键值相等的节点
- 因此，插入的时候一定是叶子节点

### 效率

- 插入有序节点，退化成单支树
- 查找效率最好 O(logn)，最坏 O(n)
- 插入效率和查找效率相同（只插入叶子节点）
- 删除效率最好 O(logn) + O(1)->只有左子树或者右子树
- 最差 O(logn) + O(logn)->左子树和右子树同时存在

## 2. 平衡二叉树

### 定义

- 它是一棵空树或它的左右两个子树的高度差的绝对值不超过 1，并且左右两个子树都是一棵平衡二叉树
- 常用算法有红黑树、AVL、Treap、伸展树等
- 在平衡二叉搜索树中，我们可以看到，其高度一般都良好地维持在 O（log2n），大大降低了操作的时间复杂度

### 调整平衡的基本思想

```
1. 当在二叉排序树中插入一个节点时，首先检查是否因插入而破坏了平衡，若破坏，则找出其中的最小不平衡二叉树,
在保持二叉排序树特性的情况下，调整最小不平衡子树中节点之间的关系，以达到新的平衡

2. 所谓最小不平衡子树，指离插入节点最近且以平衡因子的绝对值大于1的节点作为根的子树

3. 先插入指定节点，记录下当前节点的信息，LH，EH或者RH
  若左子树高LH，查看其左子树根节点的信息，若是LH，则一次右旋；
  若是RH，则一次左旋 + 一次右旋；
  若右子树高RH，查看右子树根节点的信息，若是RH，则一次左旋；
  若是LH，则一次右旋 + 一次左旋；
  调整改变的节点信息

4. 追求绝对的高度平衡，随着树的高度的增加，动态插入和删除的代价也随之增加
```

## 3. 红黑树

### 定义

- 每个结点要么是红的，要么是黑的
- 根结点是黑的
- 每个叶结点是黑的
- 如果一个结点是红的，那么它的俩个儿子都是黑的
- 对于任一结点而言，其到叶结点树尾端 NIL 指针的每一条路径都包含相同数目的黑结点

### 优点

- 解决平衡树的维护起来比较麻烦的问题，红黑树读取略逊于 AVL，维护强于 AVL
- 每次插入和删除的平均旋转次数应该是远小于平衡树

## 4. B 树，即二叉搜索树

### 定义

- 所有非叶子节点至多拥有两个子节点，即 left，right
- 所有节点存储一个关键字
- 非叶子节点的左指针指向比他关键字小的子树，右节点则指向比他大的

### 搜索原理

- B 树的搜索，从根结点开始，如果查询的关键字与结点的关键字相等，那么就命中
- 否则，如果查询关键字比结点关键字小，就进入左儿子
- 如果比结点关键字大，就进入右儿子
- 如果左儿子或右儿子的指针为空，则报告找不到相应的关键字

### 总结

- 如果 B 树的所有非叶子结点的左右子树的结点数目均保持差不多（平衡），那么 B 树的搜索性能逼近二分查找
- 比连续内存空间的二分查找的优点是，改变 B 树结构（插入与删除结点）不需要移动大段的内存数据，甚至通常是常数开销
- 在实际使用中，通常是在 B 树的基础上添加平衡算法，编程平衡二叉树
- 平衡二叉树又叫 AVL 树，是由作者姓名命名的，平衡二叉树还有一个改进的版本，叫做红黑树

## 5. B+树

### 定义

- B 树的变体，同样是一种多路搜索树
- 定义基本与 B 树相同，除了：非叶子结点的子树指针与关键字个数相同而不是多一个
- 非叶子结点子树指针 P[i]，指向关键字值属于[K[i]，K[i+1])的子树，(B 树是开区间）
- 为所有叶子结点增加了一个链指针
- 所有关键字都在叶子结点出现

### 优点

- 非叶子节点不会带上指向记录的指针，这样，一个块中可以容纳更多的索引项，一是可以降低树的高度。二是一个内部节点可以定位更多的叶子节点
- 叶子节点之间通过指针来连接，范围扫描将十分简单，而对于 B 树来说，则需要在叶子节点和内部节点不停的往返移动
- 如果需要扫描一次所有数据，对于 B+树来说，可以进行横向的遍历，而对于 B 树来说，就这能中序遍历了

## 6. 红黑树和 B+树的用途有什么区别？

- 红黑树多用在内部排序，即全放在内存中的，STL 的 map 和 set 的内部实现就是红黑树
- B+树多用于外存上时，B+也被成为一个磁盘友好的数据结构

## 7. 为什么 B+磁盘友好？

### 磁盘读写代价更低

- 树的非叶子结点里面没有数据，这样索引比较小，可以放在一个 Blcok（或者尽可能少的 Blcok）里面，避免了树形结构不断的向下查找
- 然后磁盘不停的寻道，读数据。这样的设计，可以降低 io 的次数。

### 查询效率更加稳定

- 非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路
- 所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。

### 遍历所有的数据更方便

- B+树只要遍历叶子节点就可以实现整棵树的遍历，而其他的树形结构 要中序遍历才可以访问所有的数据
